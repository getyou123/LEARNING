## 当谈论大数据的时候我们在谈论什么
  
- 大数据定义：IBM中的3V 和 4V；IDC中的新的技术架构，这种架构中的数据的高速流动和数据分析和挖掘等
- 技术范型转化： 传统互联网和商业数据采用的是 传统的关系型数据库 => 
    - hadoop
    - nosql ： 不单纯追求应用场景的统一，针对不同的应用场合有不同的解决方案
      - 社交网络使用图数据库
      - 实时性高的使用hbase等
    - 应用场景进一步推动了技术转型：
      - 数据存储
      - 数据基本处理
      - 数据挖掘与分析
      - 数据可视化
      - 主要目标是浪里淘金，获取知识
    - 大数据技术的子领域：
      - ![](https://raw.githubusercontent.com/getyou123/git_pic_use/master/zz202301300917236.png)

## 数据分片和路由
- 数据分片产生的原因： 数据量级的进化导致的传统的纵向扩展（不增加机器，提高单机性能，让单机具有更强的数据存储和数据处理能力）并不能满足大数据的挑战，所以更合适的横向扩展（增加机器）并提供数据分片，这些分片分别存储在机器上
- 数据路由：如何找到这些分片在哪个位置哪个机器上呢？ 这个问题成为数据路由
- 数据复制：在分片基数上增加副本机制，提高可用性
- 数据复制和数据分片的关系：![](https://raw.githubusercontent.com/getyou123/git_pic_use/master/zz202301300931517.png)
- 数据复制带来的问题：高可用满足了，但是如何保证多个副本之间的数据是一致的呢？

#### 数据分片和路由通用的抽象模型
- 其实就是两级映射关系
  - 第一级是文件记录=>分片的，也就是key-partition映射，这里是一对一的映射关系，按照key对数据进行水平的切分
  - 第二级是分片到机器的映射，一般是多对一的映射关系，一个机器上存储多个分片数据
  - 映射模型如图：![](https://raw.githubusercontent.com/getyou123/git_pic_use/master/zz202301301521386.png)
  - 哈希分片和范围分片：
    - hash支持点查 Point Query 常见的k-v的都是支持点查的
    - 范围及支持点查，也支持范围查询 Range Query
  
#### 哈希分片 Hash Partition
- Round Robin 方式：
  - 最最简单取模的运算：![](https://raw.githubusercontent.com/getyou123/git_pic_use/master/zz202301301529193.png)
  - 这种方式的优点在于简单，缺点在于如果新加一个机器的话，就会导致K=>k+1,这样之前的key-partition关系就失效了，只能进行重新分配
  - 缺点主要在机器数K ![](https://raw.githubusercontent.com/getyou123/git_pic_use/master/zz202301301542367.png)
- 虚拟桶 Virtual Buckets
  - 运行机制如下：![](https://raw.githubusercontent.com/getyou123/git_pic_use/master/zz202301301548310.png)
  - 就是引入了虚拟桶的概念，key-> Virtual Bucket 使用hash方式，多条记录可能落在一个桶上
  - 然后从Virtual Buckets -> 实际的物理机器是按照查表的方式来操作的
  - 这样情况下增加机器只是在Virtual Buckets 和 实际机器的查找表中增加了表项，而不会导致原来的对应关系失效
  - 这里就体现了解耦操作，增加了灵活性
### 一致性hash
- 分布式哈希表DHT，这是hash表的分布式扩展，即考虑了每台机器都是负责了一部分数据存储的情况下的，如果对数据进行增删改查
- 一致性hash是DHT的一种实现方式

### 范围分片 Range Partition